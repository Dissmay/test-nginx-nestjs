name: Docker Image CI
on:
  push:
    branches: [master]

jobs:
  #   build:
  #     runs-on: ubuntu-latest

  #     steps:
  #     - uses: actions/checkout@v2
  #     - name: docker login
  #       env:
  #         DOCKER_USER: ${{ secrets.DOCKER_USER }}
  #         DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}
  #       run: |
  #         echo $DOCKER_PASSWORD |  docker login https://docker.pkg.github.com -u $DOCKER_USER --password-stdin
  #     - name: docker build node
  #       run: |
  #        docker image build . --tag docker.pkg.github.com/dissmay/test-nginx-nestjs/test-nest
  #     - name:  docker push
  #       run: |
  #        docker push docker.pkg.github.com/dissmay/test-nginx-nestjs/test-nest:latest

  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Deploy to Server
        uses: yiier/yii2-base-deploy@master
        with:
          user: root
          host: 185.233.36.144
          path: /
          owner: root
        env:
          DOCKER_PASSWORD: ${{ secrets.DOCKER_PASSWORD }}
          DEPLOY_KEY: ${{ secrets.DEPLOY_KEY }}
          DOCKER_USER: ${{ secrets.DOCKER_USER }}
      # - name: Deploy to 1
      # run: |
      #   echo $DOCKER_PASSWORD | docker login https://docker.pkg.github.com -u $DOCKER_USER --password-stdin
      #   docker pull docker.pkg.github.com/dissmay/test-nginx-nestjs/test-nest:latest
      - name: Deploy to 2
        run: |
          echo $PWD
        shell: bash
      # - name: Deploy to 3
      #   run: |
      #     docker-compose up -d
      #   shell: bash
